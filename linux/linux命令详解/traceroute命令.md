traceroute是用来检测发出数据包的主机到目标主机之前所经过的网关数据的工具。traceroute的原理是试图以最小的TTL(存活时间)发出探测包来跟踪数据包到达目标主机所经过的网关。然后监听一个来自网关ICMP的应答。


### 安装
yum install traceroute


### 命令格式
traceroute [参数] [主机]
* -d 使用Socket层级的排错功能。 
* -f 设置第一个检测数据包的存活数值TTL的大小。 
* -F 设置勿离断位。 
* -g 设置来源路由网关，最多可设置8个。 
* -i 使用指定的网络界面送出数据包。 
* -I 使用ICMP回应取代UDP资料信息。 
* -m 设置检测数据包的最大存活数值TTL的大小。 
* -n 直接使用IP地址而非主机名称。 
* -p 设置UDP传输协议的通信端口。 
* -r 忽略普通的Routing Table，直接将数据包送到远端主机上。 
* -s 设置本地主机送出数据包的IP地址。 
* -t 设置检测数据包的TOS数值。 
* -v 详细显示指令的执行过程。 
* -w 设置等待远端主机回报的时间。 
* -x 开启或关闭数据包的正确性检验。

### 结果说明
记录按序号从1开始，每个纪录就是一跳，每跳表示一个网关，我们看到每行有三个时间，单位是ms。探测数据包向每个网关发送三个数据包后，网关响应后返回的时间。traceroute -q 4 xx表示向每个网关发送4个数据包。    
如果看到有一行是星号，这可能是防火墙封掉了ICMP(Internet控制报文协议)的返回信息，所以我们得不到什么相关的数据包返回的数据。  
如果某台DNS出现了问题不能解析主机名，域名时，也会有延时长的现象，可以加-n 参数来避免DNS解析。以IP格式输出数据。


    探测包使用的基本UDP端口设置6888 
    traceroute -p 6888 www.baidu.com 

    把对外发探测包的等待响应时间设置为3秒
    traceroute -w 3 www.baidu.com


### ICMP
ICMP是（Internet Control Message Protocol）Internet控制报文协议。它是TCP/IP协议簇的一个子协议，用于在IP主机、路由器之间传递控制消息。控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。